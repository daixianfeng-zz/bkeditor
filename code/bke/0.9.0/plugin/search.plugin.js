/*! Bkeditor - v0.9.0 - 2013-08-03
* https://github.com/daixianfeng/bkeditor
* Copyright (c) 2013 daixianfeng;*/
(function(e,t){e.addUi({id:"searchdialog",search:function(n){var i="prev"===n?!1:!0,r=t("#searchdialog");if(0!==r.size()){var o=r.find("#sourceword").val(),a=r.find("[name=whole]")[0].checked,s=r.find("[name=sensitive]")[0].checked;return e.utils.execPlugin("search","search",{backward:i,sourceword:o,whole:a,sensitive:s}),!1}return!1},replace:function(){var n=t("#searchdialog");if(0!==n.size()){var i=n.find("#sourceword").val(),r=n.find("#targetword").val(),o=n.find("[name=whole]")[0].checked,a=n.find("[name=sensitive]")[0].checked;return e.utils.execPlugin("search","replace",{backward:!0,sourceword:i,targetword:r,whole:o,sensitive:a}),!1}return!1}})})(window.jQuery.jQEditor,window.jQuery),function(e){e.dialogHtml.searchdialog='<TABLE ui="searchdialog"><TR><TD>查找：</TD><TD><input type="text" id="sourceword" name="sourceword" /></TD></TR><TR><TD>替换：</TD><TD><input type="text" id="targetword" name="targetword"/></TD></TR><TR><TD><input type="checkbox" id="whole" name="whole"/>全词匹配</TD><TD>&nbsp;</TD></TR><TR><TD><input type="checkbox" id="sensitive" name="sensitive"/>大小写相关</TD><TD>&nbsp;</TD></TR></TABLE>'}(jQuery.jQEditor),function(e){e.addPlugin({id:"search",type:"dialog",init:function(){e.utils.loadDialog(this.id,e.config.cBase.uiDir+"search/")},showDialog:function(t){var n=t.Eid;e.dialog.open({id:"searchdialog",editor:n,title:"查找",content:$("[ui=searchdialog]"),button:[{value:"<< 查找",callback:function(){return e.command("searchdialog","search","prev"),!1}},{value:"查找 >>",callback:function(){return e.command("searchdialog","search","next"),!1}},{value:"替换 ≒",callback:function(){return e.command("searchdialog","replace"),!1}}],icon:"succeed"})},search:function(t){var n=e.curEditor.win,i=!1;if(e.IE){var r=n.document.body.createTextRange();n.focus();var o=n.document.selection.createRange().duplicate();try{t.backward?r.setEndPoint("StartToEnd",o):r.setEndPoint("EndToStart",o)}catch(a){n.focus()}var s=t.sourceword,l=t.whole===!0?2:0,d=t.sensitive===!0?4:0,c=t.backward===!0?0:-1,u=l|d;i=r.findText(s,c,u),i&&r.select()}else{var s=t.sourceword,f=t.whole,m=t.sensitive,h=t.backward===!0?!1:!0;i=n.find(s,m,h,!1,f)}i||e.errorMessage("没有找到目标！")},replace:function(t){e.curEditor.win;var n=e.utils.getSelectionText();n.toLowerCase()!==t.sourceword.toLowerCase()?this.search(t):(e.utils.replaceSelectedText(e.curEditor.win,t.targetword),this.search(t))}})}(window.jQuery.jQEditor);